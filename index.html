<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>주제형 한바퀴 보드게임 (2인 대결)</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbar__inner">
      <div class="brand">
        <div class="brand__title">주제형 한바퀴 보드게임</div>
        <div class="brand__sub">주제 입력 → 말판 문제 교체 · 2인 턴제 · 파일 저장/불러오기</div>
      </div>
      <div class="topbar__actions">
        <button id="openSettings" class="settingsbtn" title="설정">
          <span aria-hidden="true">⚙️</span>
          <span>설정</span>
        </button>
      </div>
    </div>
  </header>

  <main class="page">
    <div class="layout">
    <section class="panel">

      <div class="card">
        <div class="card__title">안내</div>
        <div class="stack">
          <div class="hint">
            주제를 입력하면 말판의 문제가 바뀌는 <b>2인 수업용 보드게임</b>입니다.
            (학생 정보는 저장하지 않습니다)
          </div>
          <div class="divider"></div>
          <div class="hint" style="font-weight:900;color:#0f172a">사용 방법</div>
          <ol class="ol" style="margin-top:0">
            <li><b>주제 입력 → 문제 적용</b></li>
            <li><b>게임 시작하기</b></li>
            <li>2명이 번갈아 <b>주사위 굴리기</b></li>
            <li>원하면 <b>내 수업용 문제 파일 저장</b>으로 파일로 보관</li>
          </ol>
          <div class="divider"></div>
          <div class="hint">
            ※ AI로 문제 자동 생성을 쓰려면 우측 상단 <b>설정</b>에서 <b>Gemini API 키</b>를 입력하세요.
            키 발급은 설정 화면의 <b>API 키 발급받기</b> 버튼을 누르면 됩니다.
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card__title">게임 시작</div>
        <div class="stack">
          <label class="label">주제</label>
          <div class="row">
            <input id="topicInput" class="input" placeholder="예: 분수, 지구와 달, 조선시대, 안전교육…" />
            <button id="applyTopic" class="btn">문제 적용</button>
          </div>
          <div class="row row--wrap">
            <div class="pill" id="cellsStatus">문제: 기본 세트</div>
            <div class="pill" id="aiStatus">AI: 미사용</div>
          </div>

          <div class="divider"></div>

          <label class="label">게임</label>
          <div class="row">
            <button id="startGame" class="btn btn--primary">게임 시작하기</button>
            <button id="resetGame" class="btn btn--ghost">리셋</button>
          </div>
          <div class="hint">
            주제 적용 후 게임을 시작하면, 말판 문제는 해당 주제로 바뀐 상태로 진행됩니다.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card__title">저장</div>
        <div class="stack">
          <div class="row row--wrap">
            <button id="exportFile" class="btn">내 수업용 문제 파일 저장</button>
            <label class="btn filebtn">
              문제 파일 불러오기
              <input id="importFile" type="file" accept="application/json" />
            </label>
          </div>
          <div class="row">
            <button id="clearData" class="btn btn--danger">모든 데이터 삭제</button>
          </div>
          <div class="hint">
            ‘문제 파일’에는 주제/모델/문제 목록이 함께 저장됩니다. (각 선생님 PC에서 따로 사용)
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card__title">로그</div>
        <div id="log" class="log"></div>
      </div>
    </section>

    <section class="stage">
      <div class="stage__top">
        <div class="score">
          <div class="score__title">점수판 (합산)</div>
          <div id="scoreP1" class="score__line">🔴 빨강: 0</div>
          <div id="scoreP2" class="score__line">🔵 파랑: 0</div>
          <div id="timer" class="timer">⏳ 07:00</div>
        </div>

        <div class="controls">
          <button id="rollBtn" class="btn btn--primary" disabled>주사위 굴리기</button>
          <div class="diceArea">
            <div id="dice" class="dice"></div>
            <div id="diceResult" class="diceResult"></div>
          </div>
        </div>
      </div>

      <div id="board" class="board">
        <div id="rails" class="rails" aria-hidden="true">
          <span class="t"></span><span class="r"></span><span class="b"></span><span class="l"></span>
        </div>
        <div id="boardCenter" class="boardCenter" aria-hidden="true">
          <div class="centerText">
            <div class="centerText__title">주제형 문제 모드</div>
            <div class="centerText__sub">설정(⚙️)에서 Gemini 연결 후, 주제를 넣으면 문제가 자동으로 바뀝니다.</div>
          </div>
        </div>
      </div>
    </section>
    </div>
  </main>

  <!-- Question Modal -->
  <div id="qModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="questionText">
    <div class="modalBox">
      <div id="questionLabel" class="modalLabel"></div>
      <div id="questionText" class="modalTitle"></div>
      <img id="questionImg" class="modalImg" alt="문제 이미지" />
      <input id="answerInput" class="input" placeholder="정답 입력" />
      <div class="modalActions">
        <button id="submitAnswer" class="btn btn--primary">확인</button>
        <button id="closeQ" class="btn btn--ghost">닫기</button>
      </div>
    </div>
  </div>

  <!-- Result Modal -->
  <div id="resultModal" class="modal" role="dialog" aria-modal="true">
    <div class="modalBox">
      <div id="resultContent" class="result"></div>
    </div>
  </div>

  <!-- End Modal -->
  <div id="endModal" class="modal" role="dialog" aria-modal="true">
    <div class="modalBox">
      <div id="endContent" class="result"></div>
      <div class="modalActions">
        <button id="closeEnd" class="btn btn--primary">닫기</button>
      </div>
    </div>
  </div>

  <!-- Settings Drawer (JS/CSS와 id/class 일치) -->
  <div id="drawer" class="drawer" aria-hidden="true">
    <div class="drawer__backdrop" aria-hidden="true"></div>
    <aside class="drawer__panel" role="dialog" aria-modal="true" aria-label="설정">
      <div class="drawer__header">
        <div>
          <div class="drawer__title">설정</div>
          <div class="hint">AI 설정 · 데이터 관리 · 사용 방법</div>
        </div>
        <button id="closeSettings" class="iconbtn" title="닫기">✕</button>
      </div>

      <div class="card card--flat">
        <div class="card__title">AI 설정</div>
        <div class="stack">
          <div class="hint">
            이 앱은 <b>Gemini API 키</b>로 문제를 자동 생성합니다.<br/>
            ※ GitHub Pages(정적 사이트)에서는 키를 100% 숨길 수 없습니다. (필요 시 키를 주기적으로 재발급/폐기하세요)
          </div>

          <label class="label">모델</label>
          <select id="geminiModel" class="input">
            <option value="gemini-2.0-flash">gemini-2.0-flash</option>
            <option value="gemini-1.5-flash">gemini-1.5-flash</option>
          </select>
          <div class="hint">※ 키마다 사용 가능한 모델이 다를 수 있습니다. <b>AI 연결 테스트</b>를 누르면 지원 모델을 자동으로 불러옵니다.</div>

          <label class="label">문제 수(말판 문제 칸 수와 자동 맞춤)</label>
          <input id="genCount" class="input" type="number" min="10" max="80" step="1" value="24" />
          <div class="hint">말판의 ‘문제 칸’ 개수에 맞춰 자동 조정됩니다.</div>

          <div class="divider"></div>

          <label class="label">Gemini API 키</label>
          <input id="apiKeyInput" class="input" type="password" placeholder="예: AIza..." />
          <div class="row row--wrap">
            <button id="getKeyBtn" class="btn btn--ghost" type="button">API 키 발급받기(구글)</button>
          </div>
          <div class="hint">키는 이 브라우저(이 PC)에만 저장됩니다. 다른 PC에서는 다시 입력해야 합니다.</div>

          <div class="row row--wrap">
            <button id="saveAi" class="btn btn--primary">설정 저장</button>
            <button id="deleteKey" class="btn btn--danger">API 키 삭제</button>
            <button id="testAi" class="btn btn--ghost">AI 연결 테스트</button>
          </div>
        </div>
      </div>

      <div class="card card--flat">
        <div class="card__title">사용 방법</div>
        <ol class="ol">
          <li>처음 한 번, 설정(⚙️)에서 <b>Gemini API 키</b>를 입력해 주세요.</li>
          <li>주제 입력 → <b>문제 적용</b> (해당 주제로 말판 문제가 자동 생성됩니다)</li>
          <li><b>게임 시작하기</b> 후, 2명이 번갈아 <b>주사위 굴리기</b></li>
          <li>정답은 <b>대소문자 무시</b>, 복수 정답은 <b>|</b> 로 구분</li>
          <li><b>저장/불러오기</b>: 왼쪽 ‘내 수업용 문제 파일 저장’으로 파일로 저장하고, ‘문제 파일 불러오기’로 다시 불러옵니다.</li>
        </ol>
      </div>

      <div class="card card--flat">
        <div class="card__title">저장된 내용 미리보기(고급)</div>
        <div class="stack">
          <div class="hint">아래는 앱이 이 브라우저에 임시로 저장하는 항목 미리보기입니다. (수업용 사용에는 몰라도 됩니다)</div>
          <pre id="storagePreview" class="code"></pre>
        </div>
      </div>
    </aside>
  </div>

  <script src="./app.js"></script>
</body>
</html>
