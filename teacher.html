<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>교사용 - 주제형 한바퀴 보드게임</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body data-mode="teacher">
  <div class="container">
    <div class="header">
      <div class="title">
        <h1>주제형 한바퀴 보드게임 <span class="badge" id="modeBadge">교사용</span></h1>
        <p>주제 입력 → AI로 문제 생성 → “문제 파일 저장” 후 학생에게 배포</p>
      </div>

      <div class="tooltip" data-tip="AI 문제 자동생성은 [설정]에서 Gemini API 키를 입력하세요. (설정 안에 ‘API 키 발급받기’ 버튼이 있습니다)">
        <button class="btn small" id="openSettings">⚙️ 설정</button>
      </div>
    </div>

    <div class="topbar">
      <b>사용</b> 주제 입력 → <b>문제 적용</b> → <b>문제 파일 저장</b> → 학생용에서 <b>문제 파일 불러오기</b>
    </div>

    <div class="main">
      <div class="side">
        <div class="card">
          <h2>게임 시작</h2>

          <div class="field" style="margin-bottom:10px;">
            <label>주제</label>
            <input id="topicInput" placeholder="예: 태양계와 행성" />
            <button class="btn primary" id="applyTopic">문제 적용</button>
          </div>

          <div class="badge" data-pack-topic>문제 파일이 없습니다. (문제 적용 또는 불러오기)</div>

          <div style="height:10px"></div>

          <h2 style="margin-top:12px;">게임</h2>
          <div class="row">
            <button class="btn primary" id="startGame">게임 시작하기</button>
            <button class="btn" id="resetGame">리셋</button>
          </div>
          <p style="margin:10px 0 0; color:var(--muted); font-size:13px; line-height:1.5;">
            교사용 화면은 생성/저장이 목적입니다. 수업에서는 학생용 화면을 권장합니다.
          </p>
        </div>

        <div class="card" style="margin-top:14px;">
          <h2>저장 / 불러오기</h2>
          <div class="row">
            <button class="btn primary" id="exportPack">문제 파일 저장</button>
            <button class="btn" id="importPack">문제 파일 불러오기</button>
            <input id="importPackInput" type="file" accept=".json,application/json" style="display:none" />
          </div>
          <p style="margin:10px 0 0; color:var(--muted); font-size:13px; line-height:1.5;">
            저장된 파일(.json)을 학생용 페이지에서 불러오면 API 키 없이도 플레이 가능합니다.
          </p>
        </div>

        <div class="card" style="margin-top:14px;">
          <h2>로그</h2>
          <div class="log" id="log"></div>
        </div>
      </div>

      <div>
        <div class="card" style="padding:12px; margin-bottom:14px;">
          <div class="scorebox">
            <div class="badge"><span class="dot red"></span> 빨강: <b class="mono" id="scoreP1">0</b></div>
            <div class="badge"><span class="dot blue"></span> 파랑: <b class="mono" id="scoreP2">0</b></div>
            <div class="badge">⏳ <b class="mono" id="timer">07:00</b></div>

            <div class="diceWrap" style="margin-left:auto;">
              <button class="btn primary" id="rollBtn">주사위 굴리기</button>
              <div class="dice" id="dice"></div>
              <div class="badge mono" id="diceResult">주사위: 1</div>
            </div>
          </div>
        </div>

        <div class="boardWrap">
          <div class="board" id="board" aria-label="board"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="qModal" aria-hidden="true">
    <div class="backdrop"></div>
    <div class="panel">
      <h3 id="qTitle">문제</h3>
      <p id="qText"></p>
      <input id="aInput" placeholder="정답 입력" />
      <div class="row" style="justify-content:flex-end; margin-top:10px;">
        <button class="btn" id="aClose">닫기</button>
        <button class="btn primary" id="aSubmit">확인</button>
      </div>
    </div>
  </div>

  <div class="modal" id="resultModal" aria-hidden="true">
    <div class="backdrop"></div>
    <div class="panel">
      <h3>결과</h3>
      <p id="resultText"></p>
      <div class="row" style="justify-content:flex-end; margin-top:10px;">
        <button class="btn primary" id="resultClose">확인</button>
      </div>
    </div>
  </div>

  <div class="drawer" id="drawer" data-teacher-only>
    <div class="drawer__backdrop"></div>
    <div class="drawer__panel">
      <button class="btn small x" id="closeSettings">닫기</button>
      <h2>설정</h2>

      <div class="help">
        ※ GitHub Pages 같은 정적 사이트에서는 API 키를 100% 숨길 수 없습니다.<br/>
        수업 운영은 “교사가 문제 파일을 만든 뒤 저장 → 학생은 파일만 불러오기”를 권장합니다.
      </div>

      <hr/>

      <div class="stack">
        <div>
          <div class="help" style="margin-bottom:6px;"><b>모델</b></div>
          <select id="geminiModel">
            <option value="gemini-2.0-flash">gemini-2.0-flash</option>
            <option value="gemini-1.5-flash">gemini-1.5-flash</option>
          </select>
        </div>

        <div>
          <div class="help" style="margin-bottom:6px;"><b>문제 수</b> (덱 총 문항 수)</div>
          <input id="deckCount" type="number" min="6" max="200" value="30" />
          <div class="help">덱 소진형: 게임 중 문제칸에 도착할 때마다 다음 문제가 출제됩니다.</div>
        </div>

        <div>
          <div class="help" style="margin-bottom:6px;"><b>Gemini API 키</b></div>
          <input id="apiKeyInput" type="password" placeholder="AIza..." />
          <div class="row" style="margin-top:10px;">
            <button class="btn" id="getKeyBtn" type="button">API 키 발급받기(구글)</button>
          </div>
          <div class="help" style="margin-top:8px;">키는 이 브라우저(PC)에만 저장됩니다. 다른 PC에서는 다시 입력해야 합니다.</div>
        </div>

        <div class="row">
          <button class="btn primary" id="saveKey">키 저장</button>
          <button class="btn danger" id="deleteKey">키 삭제</button>
        </div>

        <div class="row">
          <button class="btn" id="saveAi">AI 설정 저장</button>
          <button class="btn" id="testAi">AI 연결 테스트</button>
        </div>
      </div>

      <hr/>
      <div class="help">
        학생용 페이지: <a href="./student.html">student.html로 이동</a><br/>
        홈: <a href="./index.html">index.html</a>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
