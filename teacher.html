<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>교사용 - AI 주제 탐험 보드게임</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body data-mode="teacher">
  <div class="container">
    <div class="header">
      <div class="title">
        <h1>AI 주제 탐험 보드게임 <span class="badge" id="modeBadge">교사용</span></h1>
      </div>

      <div class="row headerActions">
        <a class="btn small" href="./index.html">🏠 홈</a>
        <div class="tooltip" data-tip="AI 문제 자동생성은 [설정]에서 Gemini API 키를 입력하세요. (설정 안에 ‘API 키 발급받기’ 버튼이 있습니다)">
          <button class="btn small" id="openSettings">⚙️ 설정</button>
        </div>
      </div>
    </div>

      <div class="topbar guide">
        <div class="guideTitle">사용방법</div>
        <div class="guideSteps">
          1) <b>설정</b>에서 Gemini API 키 발급·저장 및 옵션 세팅
          <span class="sep">→</span>
          2) <b>주제 입력</b>
          <span class="sep">→</span>
          3) <b>문제 생성</b>(작동 확인)
          <span class="sep">→</span>
          4) <b>문제 파일 저장</b>
          <span class="sep">→</span>
          5) 학생에게 배부 (<b>학생용</b>에서 <b>문제 파일 불러오기</b>)
        </div>
      </div>

    <div class="main">
      <div class="side">
        <div class="card">
          <h2>게임 시작</h2>

          <div class="field" style="margin-bottom:10px;">
            <label>주제</label>
            <input id="topicInput" placeholder="예: 태양계와 행성" />
            <button class="btn softIvory" id="applyTopic">문제 생성</button>
          </div>

          <div class="hint" id="setupHint" style="display:none;">
            ⚠️ 처음 사용이라면 <button class="linkBtn" type="button" id="openSettingsInline">설정</button>에서 Gemini API 키를 저장한 뒤 ‘문제 생성’을 눌러주세요.
          </div>

                    <div class="badge" data-pack-topic>문제 파일이 없습니다.<br><span class="muted">(문제 생성 또는 불러오기)</span></div>

          <div style="height:10px"></div>

          <h2 style="margin-top:12px;">게임</h2>
          <div class="row">
            <button class="btn softBlue" id="startGame">게임 시작하기</button>
            <button class="btn softPink" id="resetGame">다시하기</button>
          </div>
          <p style="margin:10px 0 0; color:var(--muted); font-size:13px; line-height:1.5;">
            교사용 화면은 생성/저장이 목적입니다. 수업에서는 학생용 화면을 권장합니다.
          </p>
        </div>

        <div class="card" style="margin-top:14px;">
          <h2>저장 / 불러오기</h2>
          <div class="row">
            <button class="btn softBlue" id="exportPack">문제 파일 저장</button>
            <button class="btn softPink" id="importPack">문제 파일 불러오기</button>
            <input id="importPackInput" type="file" accept=".json,application/json" style="display:none" />
          </div>
          <p style="margin:10px 0 0; color:var(--muted); font-size:13px; line-height:1.5;">
            저장된 파일(.json)을 학생용 페이지에서 불러오면 API 키 없이도 플레이 가능합니다.
          </p>
        </div>

        <div class="card" style="margin-top:14px;">
          <h2>진행상황</h2>
          <div class="log" id="log"></div>
        </div>
      </div>

      <div>
        <div class="card" style="padding:12px; margin-bottom:14px;">
          <div class="scorebox">
            <div class="badge"><span class="dot red"></span> 빨강: <b class="mono" id="scoreP1">0</b></div>
            <div class="badge"><span class="dot blue"></span> 파랑: <b class="mono" id="scoreP2">0</b></div>
            <div class="badge">⏳ <b class="mono" id="timer">07:00</b></div>

            <div class="diceWrap" style="margin-left:auto;">
              <button class="btn softPink" id="rollBtn">주사위 굴리기</button>
              <div class="dice" id="dice"></div>
              <div class="badge mono" id="diceResult">주사위: 1</div>
            </div>
          </div>
        </div>

        <div class="boardWrap">
          <div class="board" id="board" aria-label="board"></div>
          <div class="centerTopicCard" id="centerTopicCard" aria-hidden="true">
            <div class="centerTopicTitle">오늘의 탐험 주제</div>
            <div class="centerTopicText" id="centerTopicText">주제를 입력하세요</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="qModal" aria-hidden="true">
    <div class="backdrop"></div>
    <div class="panel">
      <h3 id="qTitle">문제</h3>
      <p id="qText"></p>
      <div id="choiceWrap" class="choices"></div>
      <input id="aInput" placeholder="정답 입력" style="display:none" />
      <div class="row" style="justify-content:flex-end; margin-top:10px;">
        <button class="btn" id="aClose">닫기</button>
        <button class="btn primary" id="aSubmit">확인</button>
      </div>
    </div>
  </div>

  <div class="modal" id="resultModal" aria-hidden="true">
    <div class="backdrop"></div>
    <div class="panel">
      <h3 id="resultTitle">결과</h3>
      <textarea id="resultText" class="resultTextArea" readonly></textarea>
      <div class="row" style="justify-content:flex-end; margin-top:10px;">
<button class="btn primary" id="resultClose">확인</button>
      </div>
    </div>
  </div>

  <div class="drawer" id="drawer" data-teacher-only>
    <div class="drawer__backdrop"></div>
    <div class="drawer__panel">
      <button class="btn small x" id="closeSettings">닫기</button>
      <h2>설정</h2>

      <hr/>

      <div class="settingCards">

        <section class="settingCard cardA">
          <div class="settingCardHeader">
            <div class="settingCardTitle">AI 연결 설정</div>
            <div class="settingCardDesc">아래 옵션들을 설정하세요.</div>
          </div>

          <div class="formGroup">
            <div class="setting-label">Gemini API 키</div>
            <input id="apiKeyInput" type="password" placeholder="AIza..." />
            <div class="row" style="margin-top:10px;">
              <button class="btn softYellow" id="getKeyBtn" type="button">API 키 발급받기(구글)</button>
            </div>
            <div class="help" style="margin-top:8px;">키는 이 브라우저(PC)에만 저장됩니다. 다른 PC에서는 다시 입력해야 합니다.</div>
          </div>

          <div class="row actions">
            <button class="btn softBlue" id="saveKey">키 저장</button>
            <button class="btn softPink" id="deleteKey">키 삭제</button>
            <button class="btn" id="testAi">AI 연결 테스트</button>
          </div>
        </section>

        <section class="settingCard cardB">
          <div class="settingCardHeader">
            <div class="settingCardTitle">문제 생성 설정</div>
            <div class="settingCardDesc">AI 모델 유형과 문항 유형을 정합니다.</div>
          </div>

          <div class="formGrid">
            <div class="formGroup">
              <div class="setting-label">모델</div>
              <select id="geminiModel">
                <option value="gemini-2.0-flash">gemini-2.0-flash</option>
                <option value="gemini-1.5-flash">gemini-1.5-flash</option>
              </select>
            </div>

            <div class="formGroup">
              <div class="setting-label">문항 유형</div>
              <select id="qMode">
                <option value="mcq">4지선다</option>
                <option value="mcq_ox">4지선다+ ox퀴즈</option>
              </select>
              <div class="help">기본은 4지선다입니다. OX를 함께 생성할 수도 있습니다.</div>
            </div>
          </div>

          <div class="formGroup">
            <label class="setting-check" style="margin-top:6px;">
              <input id="showAnswer" type="checkbox" checked />
              <span>학생 화면에서 정답/해설 공개</span>
            </label>
            <div class="help">끄면 학생은 정오답만 확인하고 정답/해설은 보지 못합니다.</div>
          </div>
        </section>

        <section class="settingCard cardC">
          <div class="settingCardHeader">
            <div class="settingCardTitle">게임 진행 설정</div>
            <div class="settingCardDesc">게임 흐름(문항 수/시간)을 정합니다.</div>
          </div>

          <div class="formGrid">
            <div class="formGroup">
              <div class="setting-label">문제 수 <span class="setting-sub">(덱 총 문항 수)</span></div>
              <input id="deckCount" type="number" min="6" max="200" value="30" />
              <div class="help">덱 소진형: 문제칸 도착 시 다음 문제가 출제됩니다.</div>
            </div>

            <div class="formGroup">
              <div class="setting-label">활동시간 <span class="setting-sub">(분)</span></div>
              <input id="activityMinutes" type="number" min="1" max="180" value="7" />
              <div class="help">게임 시작 시 타이머가 이 시간으로 설정됩니다.</div>
            </div>
          </div>

          <div class="row">
            <button class="btn primary" id="saveAi">설정 저장</button>
          </div>
        </section>
      </div>

      <hr/>
      <div class="help">
        학생용 페이지: <a href="./student.html">student.html로 이동</a><br/>
        홈: <a href="./index.html">index.html</a>
      </div>
    </div>
  </div>

  <script src="./gate.js"></script>
  <script>TeacherGate.requireAuthOnTeacherPage({homeUrl:"./index.html"});</script>
  <script src="./app.v9.js"></script>
</body>
</html>
